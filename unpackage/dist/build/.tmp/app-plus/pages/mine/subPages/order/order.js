(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mine/subPages/order/order"],{"2b19":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n("a34a")),i=o(n("3cb4")),s=o(n("3db3")),a=n("78dd");function o(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n,r,i,s,a){try{var o=e[s](a),c=o.value}catch(u){return void n(u)}o.done?t(c):Promise.resolve(c).then(r,i)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){c(s,r,i,a,o,"next",e)}function o(e){c(s,r,i,a,o,"throw",e)}a(void 0)})}}function d(e,t){return p(e)||f(e,t)||l()}function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function f(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)if(n.push(a.value),t&&n.length===t)break}catch(c){i=!0,s=c}finally{try{r||null==o["return"]||o["return"]()}finally{if(i)throw s}}return n}function p(e){if(Array.isArray(e))return e}var g={data:function(){return{currenIndex:0,swiperCurrent:0,minHeight:0,windowHeight:0,scrollHeight:0,couponStatus:["全部","待支付","待收货","待评价"],couponList:[[],[],[],[]],type:"",realPrice:0,payType:"alipay",order_sn:""}},components:{uniPopup:i.default,payMethods:s.default},onLoad:function(e){if(this._getWindowHeight(),e.id){if(this._getOrderList(e.id),0==e.id)return this.currenIndex=1,void(this.swiperCurrent=1);this.currenIndex=e.id,this.swiperCurrent=e.id}else this._getOrderList("all")},onShow:function(){this._getOrderList("all"),this._getOrderList(0)},methods:{payClick:function(){var t=this,n=this;e.request({url:a.BASE_URL+"/app/close/payMoney",method:"POST",data:{token:e.getStorageSync("token"),order_sn:this.order_sn,way:this.payType}}).then(function(r){var i=d(r,2),s=(i[0],i[1]);console.log(JSON.stringify(s)),"alipay"!=n.payType?"wechat"!=t.payType?1e4==s.data.recode?e.redirectTo({url:"/pages/success/index?title=支付成功"}):e.showToast({title:s.data.remsg,icon:"none"}):e.requestPayment({provider:"wxpay",orderInfo:s.data,success:function(t){console.log("success:"+JSON.stringify(t)),"requestPayment:ok"==t.errMsg&&e.redirectTo({url:"/pages/success/index?title=支付成功"})},fail:function(e){console.log("err:"+JSON.stringify(e))}}):e.requestPayment({provider:"alipay",orderInfo:s.data,success:function(t){"requestPayment:ok"==t.errMsg&&e.redirectTo({url:"/pages/success/index?title=支付成功"})},fail:function(e){console.log("err:"+JSON.stringify(e)),n.type=""}})})},togglePopup:function(e){this.type=e},payTypeClick:function(e){switch(e){case 0:this.payType="alipay";break;case 1:this.payType="wechat";break;case 2:this.payType="burse";break}},payment:function(){var e=u(r.default.mark(function e(t){return r.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:console.log(t),this,this.order_sn=t.order_sn,this.realPrice=t.sprice,this.type="bottom";case 5:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),pay:function(){var t=u(r.default.mark(function t(n){var i;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,a.immediatePayment)({token:e.getStorageSync("token"),order_sn:n.order_sn});case 2:if(i=t.sent,1!=n.pay_way){t.next=7;break}return console.log(JSON.stringify(i)),e.requestPayment({provider:"alipay",orderInfo:i,success:function(t){"requestPayment:ok"==t.errMsg&&e.navigateTo({url:"/pages/success/index?title=支付成功"})},fail:function(t){console.log("err:"+JSON.stringify(t)),e.redirectTo({url:"/pages/fail/index?title=购买失败"})}}),t.abrupt("return");case 7:if(2!=n.pay_way){t.next=10;break}return e.requestPayment({provider:"wxpay",orderInfo:i,success:function(t){console.log("success:"+JSON.stringify(t)),"requestPayment:ok"==t.errMsg&&e.redirectTo({url:"/pages/success/index?title=购买成功"})},fail:function(t){console.log("err:"+JSON.stringify(t)),e.redirectTo({url:"/pages/fail/index?title=购买失败"})}}),t.abrupt("return");case 10:1e4==i.recode?(this._getOrderList("all"),this._getOrderList(0)):e.redirectTo({url:"/pages/fail/index?title=购买失败"});case 11:case"end":return t.stop()}},t,this)}));function n(e){return t.apply(this,arguments)}return n}(),onBuyAgain:function(t){console.log(t);var n=[];t.data.forEach(function(e,t){var r=e.xgoods_id,i=e.num,s=e.shop_price;n.push({xgoods_id:r,num:i,shop_price:s})}),n=JSON.stringify(n);var r=[];t.data.forEach(function(e,t){var n=e.xgoods_id,i=e.num;r.push({xgoods_id:n,num:i})}),e.request({url:a.BASE_URL+"/app/xorder/buyAgain",method:"POST",data:{token:e.getStorageSync("token"),xgoods:r},success:function(t){if(1e4==t.data.recode){var r=JSON.stringify(t.data.data),i=t.data.data.freight;e.navigateTo({url:"/pages/car/subPages/pay/pay?data="+r+"&carId="+n+"&freight="+i,animationType:"slide-in-right"})}}})},cancel:function(){var t=u(r.default.mark(function t(n){var i;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:i=this,e.showModal({title:"提示",content:"确定要取消订单吗?",success:function(t){t.confirm&&(0,a.cancelOrder)({token:e.getStorageSync("token"),order_sn:n}).then(function(t){1e4==t.recode?(e.showToast({title:"取消成功"}),0==i.currenIndex&&i._getOrderList("all"),1==i.currenIndex&&i._getOrderList(0)):e.showToast({title:t.remsg,icon:"none"})})}});case 2:case"end":return t.stop()}},t,this)}));function n(e){return t.apply(this,arguments)}return n}(),confirm:function(){var t=u(r.default.mark(function t(n){var i;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:i=this,e.showModal({title:"提示",content:"请确认收到货后再执行此操作,继续确定吗？",success:function(t){t.confirm&&(0,a.confirmReceipt)({token:e.getStorageSync("token"),order_sn:n}).then(function(t){1e4==t.recode?(e.showToast({title:"确认成功"}),0==i.swiperCurrent&&i._getOrderList("all"),2==i.swiperCurrent&&i._getOrderList(2)):e.showToast({title:t.remsg,icon:"none"})})}});case 2:case"end":return t.stop()}},t,this)}));function n(e){return t.apply(this,arguments)}return n}(),_getOrderList:function(){var t=u(r.default.mark(function t(n){var i;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e.showLoading({title:"正在加载数据..."}),t.next=3,(0,a.getOrderList)({token:e.getStorageSync("token"),status:n});case 3:i=t.sent,e.hideLoading(),"all"==n?n=0:0==n&&(n=1),this.$set(this.couponList,n,i.data||[]);case 7:case"end":return t.stop()}},t,this)}));function n(e){return t.apply(this,arguments)}return n}(),evaluate:function(t){e.navigateTo({url:"/pages/mine/subPages/evaluate/evaluate?id="+t,animationType:"slide-in-right"})},getOrderByIndex:function(){var e="";switch(this.currenIndex){case 0:e="all";break;case 1:e=0;break;case 2:e=2;break;case 3:e=3}this._getOrderList(e)},swiperChange:function(e){this.currenIndex=e.detail.current,this.getOrderByIndex()},scrollClick:function(e){this.currenIndex=e,this.swiperCurrent=e,this.getOrderByIndex()},_getWindowHeight:function(){var t=this;e.getSystemInfo({success:function(e){t.windowHeight=e.windowHeight,t._getSwiperHeight()}})},_getSwiperHeight:function(){var e=[];this.couponList.forEach(function(t,n){e.push(t.length)});for(var t=0;t<e.length;t++)for(var n=0;n<e.length;n++)if(e[n+1]<e[n]){var r=e[n];e[n]=e[n+1],e[n+1]=r}this.scrollHeight=this.windowHeight-43+"px",this.minHeight=(180*e[0]<this.windowHeight-43?this.windowHeight-43:180*e[0])+"px"}}};t.default=g}).call(this,n("6e42")["default"])},"3ee7":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:"coupon"},[n("scroll-view",{staticClass:"scroll-view_H",attrs:{"scroll-x":"true"}},e._l(e.couponStatus,function(t,r){return n("view",{key:r,staticClass:"scroll-view-item_H",class:{active:e.currenIndex==r},attrs:{id:"demo1",eventid:"23875e75-0-"+r},on:{tap:function(t){e.scrollClick(r)}}},[e._v(e._s(t))])})),n("swiper",{staticClass:"swiper",style:{height:e.minHeight},attrs:{current:e.swiperCurrent,eventid:"23875e75-6"},on:{change:e.swiperChange}},e._l(e.couponList,function(t,r){return n("swiper-item",{key:r,attrs:{mpcomid:"23875e75-0-"+r}},[n("scroll-view",{style:{height:e.scrollHeight},attrs:{"scroll-y":"true"}},[e._l(e.couponList[r],function(t,i){return n("view",{key:i,staticClass:"swiper-item"},[n("view",{staticClass:"goods-status"},[e._v(e._s(t.order_status))]),e._l(t.data,function(t,r){return n("view",{key:r,staticClass:"swiper-top"},[n("image",{attrs:{src:t.goods_image}}),n("view",{staticClass:"goods-info"},[n("view",{staticClass:"goods-name"},[e._v(e._s(t.goods_name))]),n("view",{staticClass:"goods-price"},[e._v("￥"+e._s(t.shop_price))])]),n("view",{staticClass:"goods-num"},[n("view",{staticClass:"goods-num"},[e._v("×"+e._s(t.num))])])])}),n("view",{staticClass:"goods-total"},[e._v("共"+e._s(t.snum)+"件商品 合计：¥ "+e._s(t.sprice))]),n("view",{staticClass:"goods-btn"},["待付款"==t.order_status||"代付款"==t.order_status?n("view",{staticClass:"cancel",attrs:{eventid:"23875e75-1-"+r+"-"+i},on:{tap:function(n){e.cancel(t.order_sn)}}},[e._v("取消订单")]):e._e(),"待付款"==t.order_status||"代付款"==t.order_status?n("view",{attrs:{eventid:"23875e75-2-"+r+"-"+i},on:{tap:function(n){e.payment(t)}}},[e._v("立即支付")]):e._e(),"待评价"==t.order_status?n("view",{attrs:{eventid:"23875e75-3-"+r+"-"+i},on:{tap:function(n){e.evaluate(t.order_sn)}}},[e._v("立即评价")]):e._e(),"待付款"!==t.order_status&&"代付款"!==t.order_status?n("view",{attrs:{eventid:"23875e75-4-"+r+"-"+i},on:{tap:function(n){e.onBuyAgain(t)}}},[e._v("再次购买")]):e._e(),"待收货"==t.order_status?n("view",{attrs:{eventid:"23875e75-5-"+r+"-"+i},on:{tap:function(n){e.confirm(t.order_sn)}}},[e._v("确认收货")]):e._e()])],2)}),t.length<=0?n("view",{directives:[{name:"show",rawName:"v-show",value:0==t.length,expression:"data.length == 0"}],staticClass:"item nodata"},[n("image",{attrs:{src:"/static/images/mine/nodata1.png"}}),0==e.currenIndex?n("view",[e._v("您的订单是空的...")]):e._e(),1==e.currenIndex?n("view",[e._v("没有待支付订单")]):e._e(),2==e.currenIndex?n("view",[e._v("没有待收货订单")]):e._e(),3==e.currenIndex?n("view",[e._v("没有待评价订单")]):e._e()]):e._e()],2)],1)})),n("uni-popup",{attrs:{show:"bottom"===e.type,position:"bottom",msg:"",eventid:"23875e75-8",mpcomid:"23875e75-2"},on:{hidePopup:function(t){e.togglePopup("")}}},[n("view",{staticClass:"pay-methods"},[n("pay-methods",{attrs:{buttonClick:e.payClick,realPrice:e.realPrice,eventid:"23875e75-7",mpcomid:"23875e75-1"},on:{payTypeClick:e.payTypeClick}})],1)])],1)},i=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i})},"4af7":function(e,t,n){"use strict";n.r(t);var r=n("3ee7"),i=n("9a43");for(var s in i)"default"!==s&&function(e){n.d(t,e,function(){return i[e]})}(s);n("9a14");var a=n("2877"),o=Object(a["a"])(i["default"],r["a"],r["b"],!1,null,"9d755f7c",null);t["default"]=o.exports},"84f9":function(e,t,n){"use strict";n("4b50");var r=s(n("b0ce")),i=s(n("4af7"));function s(e){return e&&e.__esModule?e:{default:e}}Page((0,r.default)(i.default))},"9a14":function(e,t,n){"use strict";var r=n("c985"),i=n.n(r);i.a},"9a43":function(e,t,n){"use strict";n.r(t);var r=n("2b19"),i=n.n(r);for(var s in r)"default"!==s&&function(e){n.d(t,e,function(){return r[e]})}(s);t["default"]=i.a},c985:function(e,t,n){}},[["84f9","common/runtime","common/vendor"]]]);